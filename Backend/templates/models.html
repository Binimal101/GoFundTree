<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Select - GoFundTree</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Top Row with Back Button -->
    <div class="container-fluid p-2 bg-light border-bottom">
        <div class="d-flex justify-content-start align-items-center">
            <!-- Back Button -->
            <button class="btn back-button">
                <i class="bi bi-arrow-left"></i> Back
            </button>
        </div>
    </div>

    <!-- Form Section -->
    <div class="container mt-3">
        <form id="model-select-form">
            <!-- Post Name Input -->
            <div class="mb-3">
                <label for="postName" class="form-label">Post Name</label>
                <input type="text" class="form-control" id="postName" placeholder="Enter post name" required>
            </div>

            <!-- Description Input -->
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" rows="3" placeholder="Enter description" required></textarea>
            </div>

            <!-- WHERE THE TREE MODELS WILL GO -->
            <div class="container-fluid">
                <div class="row text-center">
                    <!-- Pine Tree -->
                    <div class="col-12 col-sm-4 mb-3">
                        <button type="button" class="image-button" id="pine-tree-btn" onclick="selectModel('pine-tree-btn', 'Pine_tree1.usdz')">
                            <img src="PineTreePic1.png" alt="Pine Tree" class="img-fluid rounded-image">
                        </button>
                    </div>
                    <!-- Regular Tree -->
                    <div class="col-12 col-sm-4 mb-3">
                        <button type="button" class="image-button" id="regular-tree-btn" onclick="selectModel('regular-tree-btn', 'Maple_tree2.usdz')">
                            <img src="CityTree2.png" alt="Regular Tree" class="img-fluid rounded-image">
                        </button>
                    </div>
                    <!-- Park Tree -->
                    <div class="col-12 col-sm-4 mb-3">
                        <button type="button" class="image-button" id="park-tree-btn" onclick="selectModel('park-tree-btn', 'Stylized_Tree3.usdz')">
                            <img src="ParkTree3.png" alt="Park Tree" class="img-fluid rounded-image">
                        </button>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-success">Submit</button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    var baseURL = "http://127.0.0.1:5000";
    var PID;

    // Handle the form submission
    document.getElementById("model-select-form").addEventListener("submit", function (event) {
        event.preventDefault();
        submitInformation();
    });

    function detectOS() {
        const userAgent = navigator.userAgent.toLowerCase();
        return /iphone|ipad|ipod/.test(userAgent) ? "IOS" : "Android";
    }

    function submitInformation() {
        let payload = {
            "name": document.getElementById("postName").value,
            "description": document.getElementById("description").value,
            "os_string": detectOS(),
            "objectList": [
                { "name": "Tree", "count": document.getElementById("treeCount") ? document.getElementById("treeCount").value : 0 },
                { "name": "Bush", "count": document.getElementById("bushCount") ? document.getElementById("bushCount").value : 0 },
            ],
        };
        console.log(`${baseURL}/api/initProject`);

        // Send the data to the backend
        fetch(`${baseURL}/api/initProject`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error("Init program post was not ok");
            }
            return response.json();
        })
        .then(data => {
            PID = data.PID;

            // Redirect to the virtualize page with the PID
            window.location.href = `${baseURL}/visualize/${PID}`;
        });
    }

    // Global variable to store the selected 3D model file
    let selectedModel = null;

    function selectModel(buttonId, modelFile) {
        // Remove active class from all buttons
        document.querySelectorAll('.image-button').forEach(btn => {
            btn.classList.remove('active');
        });

        // Add active class to the clicked button
        const selectedButton = document.getElementById(buttonId);
        selectedButton.classList.add('active');

        // Set the selected model file as the global variable
        selectedModel = modelFile;

        console.log('Selected model:', selectedModel);
    }

    function submitSelection() {
        if (selectedModel) {
            console.log('Submitted model:', selectedModel);
        } else {
            alert('Please select a tree model before submitting.');
        }
    }

    </script>
</body>
</html>
